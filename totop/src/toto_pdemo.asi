	.SBTTL	TOTO_PDEMO.ASI;--------\\; DEMOGET >;========/; Cherche la position suivante.; in	-; out	D4.L	position de la souris;	D7.W	erreur; mod	D4.L, D7.WDEMOGET:	PUSHM.L	D3,A3	LOAD.L	A3,(A6)+OPDEMO	LOAD.L	D3,(A6)+OLDEMO	LOAD.W	D4,(A3)+(D3.L)+0	COMP.W	D4,#-1	JUMP',EQ END$	TEST.W	D4	JUMP',LE POS$	COMP.W	D4,#50*10	JUMP',LO DEL$	LOAD.W	D4,#50*10DEL$:	NTREL	?DELMS		; attend ...POS$:	LOAD.L	D4,(A3)+(D3.L)+2	CALL	DEMOCROIX	; allume la croix;;?	PUSH.W	D4;;?	LOAD.W	D4,#50/2;;?	NTREL	?DELMS;;?	POP.W	D4	ADD.L	(A6)+OLDEMO,#6	CLR.W	D7		; D7 <-- ok	JUMP'	EXIT$END$:	LOAD.W	D4,#50*2	NTREL	?DELMS	LOAD.W	D7,#1		; D7 <-- faudra recommencerEXIT$:	POPM.L	D3,A3	TEST.W	D7		; retour EQ/NE	RET;----------\\; DEMOCROIX >;----------/; Dessine une jolie croix.; in	D4.L	centre de la croix; out	-; mod	D7.WDEMOCROIX:	PUSHM.L	D0..D4,A3	LOAD.L	D1,D4	LOAD.L	A3,#R16"TPEN1$	LOAD.W	D3,#9	LIB	?STRING	LOAD.L	D3,D1	SUB.W	D3,#40/2	SWAP.W	D3	SUB.W	D3,#40/2	SWAP.W	D3	LOAD.L	D4,#H'10000*40+40	LOAD.W	D2,#CLRDOT!PENDOT	LIB	?DRSEG	SUB.W	D3,D4	SWAP.W	D4	NEG.W	D4	SWAP.W	D4	LIB	?DRSEG	LOAD.L	A3,#R16"TPEN2$	LOAD.W	D3,#9	LIB	?STRING	LOAD.W	D0,#5-1LOOP$:	LOAD.W	D4,#8	NTREL	?DELMS	LOAD.L	D3,D1	SUB.W	D3,#40/2	SWAP.W	D3	SUB.W	D3,#40/2	SWAP.W	D3	LOAD.L	D4,#H'10000*40+40	LOAD.W	D2,#INVDOT!PENDOT	LIB	?DRSEG	SUB.W	D3,D4	SWAP.W	D4	NEG.W	D4	SWAP.W	D4	LIB	?DRSEG	DECJ.W,NMO D0,LOOP$	POPM.L	D0..D4,A3	RETTPEN1$:	.B	PEN	.B	B'00111100	.B	B'01111110	.B	B'11111111	.B	B'11111111	.B	B'11111111	.B	B'11111111	.B	B'01111110	.B	B'00111100TPEN2$:	.B	PEN	.B	B'00000000	.B	B'00011000	.B	B'00111100	.B	B'01111110	.B	B'01111110	.B	B'00111100	.B	B'00011000	.B	B'00000000	.EVEN;---------\\; DEMOREAD >;=========/; Lit le fichier de dmonstration.; in	A3.L	^nom du fichier; out	D7.W	erreur; mod	D7.WDEMOREAD:	PUSHM.L	D1,D3,D4,D6,A4	TEST.L	(A6)+OPDEMO	; TOTO_P.DEMO dj lu ?	JUMP',EQ FREE$		; non => FREE$	LOAD.L	A4,(A6)+OPDEMO	; oui =>	LOAD.W	D1,#MTYPCP	GESMEM	?GIVMEM		; libre la mmoire	CLR.L	(A6)+OPDEMOFREE$:	LOAD.W	D3,#2^BOPRD!2^BOPSYS ; D3 <-- mode d'ouverture	FOS	?OPEN		; ouvre le fichier	JUMP,NE EXIT$	LOAD.L	A4,#(A6)+OBUHEAD	LOAD.L	D4,#LHEAD	FOS	?RDBYTE		; lit l'en-tte	JUMP,NE CLOSE$	LOAD.W	D7,#ERFOS	COMP.L	(A4)+OHDID,#HDID	JUMP,NE CLOSE$	COMP.B	(A4)+OHDREV,#TOTOREV	JUMP,NE CLOSE$	COMP.B	(A4)+OHDVERS,#TOTOVERS	JUMP,NE CLOSE$	LOAD.W	D3,#-1	LOAD.L	D4,#-1	FOS	?SPOS		; va tout  la fin	SUB.L	D4,#LHEAD	LOAD.L	D1,D4		; D1 <-- longueur du fichier	CLR.W	D3	LOAD.L	D4,#LHEAD	FOS	?SPOS		; revient au dbut	JUMP',NE CLOSE$	LOAD.L	D4,D1	LOAD.W	D1,#MTYPCP	GESMEM	?GETMEM		; rserve de la mmoire	JUMP',NE CLOSE$	LOAD.L	(A6)+OPDEMO,A4	FOS	?RDBYTE		; lit le fichier	JUMP',NE GIVMEM$	FOS	?CLOSE		; ferme le fichier	JUMP',EQ EXIT$GIVMEM$:	PUSH.W	D7	LOAD.W	D1,#MTYPCP	GESMEM	?GIVMEM		; libre la mmoire	CLR.L	(A6)+OPDEMO	POP.W	D7CLOSE$:	PUSH.W	D7	FOS	?CLOSE		; ferme le fichier	POP.W	D7EXIT$:	POPM.L	D1,D3,D4,D6,A4	TEST.W	D7		; retour EQ/NE	RET;--------\\; DEMOPUT >;========/; Enregistre la position de la souris.; in	D4.L	position de la souris; out	-; mod	D7.WDEMOPUT:	PUSHM.L	D3,D4,A3	LOAD.L	A3,(A6)+OPDEMO	LOAD.L	D3,(A6)+OLDEMO	LOAD.L	(A3)+(D3.L)+2,D4	CALL	DEMOGETTIME	; D4 <-- temps actuel	SUB.W	D4,(A6)+OTDEMO	; D4 <-- temps coul	JUMP',HI TIME$	CLR.W	D4TIME$:	LOAD.W	(A3)+(D3.L)+0,D4	ADD.L	(A6)+OLDEMO,#6	POPM.L	D3,D4,A3	RET;----------\\; DEMOWRITE >;==========/; Ecrit le fichier de dmonstration.; in	A3.L	^nom du fichier; out	D7.W	erreur; mod	D7.WDEMOWRITE:	PUSHM.L	D3,D4,D6,A4	CLR.W	D7	TEST.L	(A6)+OLDEMO	JUMP,EQ EXIT$	FOS	?DELETE		; dtruit si ncessaire	LOAD.L	D3,#DEFATT	LOAD.W	D4,#TYPRAND	FOS	?CREATE		; cre le fichier	JUMP,NE EXIT$	LOAD.W	D3,#2^BOPWR!2^BOPEXCL!2^BOPSYS ; D3 <-- mode d'ouverture	FOS	?OPEN		; ouvre le fichier	JUMP,NE EXIT$	LOAD.L	A4,#(A6)+OBUHEAD	LOAD.L	D4,#LHEAD	GESMEM	?CLEARMEM	LOAD.L	(A4)+OHDID,#HDID	LOAD.B	(A4)+OHDREV,#TOTOREV	LOAD.B	(A4)+OHDVERS,#TOTOVERS	FOS	?WRBYTE		; crit l'en-tte	JUMP',NE CLOSE$	LOAD.L	A4,(A6)+OPDEMO	LOAD.L	D4,(A6)+OLDEMO	LOAD.W	(A4)+(D4.L),#-1	ADD.L	D4,#2	FOS	?WRBYTE	JUMP',NE CLOSE$	FOS	?CLOSE		; ferme le fichier	JUMP',EQ EXIT$CLOSE$:	PUSH.W	D7	FOS	?CLOSE		; ferme le fichier	POP.W	D7EXIT$:	POPM.L	D3,D4,D6,A4	TEST.W	D7		; retour EQ/NE	RET;---------\\; DEMOTIME >;=========/; Mmorise le temps de dpart.; in	-; out	-; mod	D7.WDEMOTIME:	PUSH.L	D4	CALL	DEMOGETTIME	LOAD.W	(A6)+OTDEMO,D4	POP.L	D4	RET;------------\\; DEMOGETTIME >;------------/; Lit le temps systme.; in	-; out	D4.W	temps actuel [20ms]; mod	D4.L, D7.WDEMOGETTIME:	PUSHM.L	D2,D3,D5	NTREL	?GETSYTIME	SUB.L	D4,(A6)+OSDEMO	DIV.WU	D4,#20000/128	POPM.L	D2,D3,D5	RET	.END