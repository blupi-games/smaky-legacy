	.SBTTL	TOTO_POBJ.ASI;--------\\; OBJDET  >;========/; Enlve l'objet montr par la souris.; in	D4.L	position de la souris (y;x); out	D7.W	erreur; mod	D7.WOBJDET:	PUSHM.L	D1..D4,A2..A4	LOAD.L	D1,D4		; D1 <-- position	LOAD.L	A2,#(A6)+ODO	LOAD.W	D2,#NBSEARCH-1LOOP$:	TEST.B	(A2)+ODOAFF	; objet affich ?	JUMP,EQ NEXT$		; non => NEXT$	LOAD.L	A4,#R16"TAOBJ	LOAD.W	D4,(A2)+ODORAN	MUL.WU	D4,#6	ADD.L	A4,D4		; A4 <-- ^dans TAOBJ	LOAD.W	D4,(A4)+0	COMP.W	D4,(A6)+OIMA	JUMP,NE NEXT$	LOAD.W	D3,(A4)+2	SUB.W	D3,#MARGOBJ	COMP.W	D1,D3	JUMP,LT NEXT$	ADD.W	D3,#LXOBJ+MARGOBJ	COMP.W	D1,D3	JUMP,GT NEXT$	LOAD.L	D4,D1	SWAP.W	D4	LOAD.W	D3,#LYWDO-1	SUB.W	D3,(A4)+4	SUB.W	D3,#MARGOBJ	COMP.W	D4,D3	JUMP,LT NEXT$	ADD.W	D3,#LYOBJ+MARGOBJ	COMP.W	D4,D3	JUMP,GT NEXT$	CALL	CCMO		; enlve la souris	CLR.L	D4	CALL	DRMDEF	LOAD.W	D3,#LYWDO-1	SUB.W	D3,(A4)+4	SWAP.W	D3	LOAD.W	D3,(A4)+2	LOAD.L	D4,#H'10000*(LYOBJ-1)+(LXOBJ-1)	LOAD.W	D2,#LOADDOT	LIB	?DRTRAME	; efface l'objet	LOAD.W	D2,#SETDOT	PUSH.L	D3	LIB	?DRSEG	POP.L	D3	ADD.W	D3,D4	DEC.W	D3	NEG.W	D4	LIB	?DRSEG		; biffe l'objet	LOAD.W	(A6)+OSOUND,#TMUSOBJET	CLR.B	(A2)+ODOAFF	; objet trouv (ne plus afficher)	DEC.W	(A6)+OREST	LOAD.W	D4,(A6)+OIMA	CLR.L	D3	LOAD.W	D2,#PROGQUICK	CALL	AFIMAGE		; affiche l'image sans l'objet	CLR.W	D7	JUMP'	EXIT$NEXT$:	ADD.L	A2,#LDO	DECJ.W,NMO D2,LOOP$	LOAD.W	D7,#1		; D7 <-- rien trouvEXIT$:	POPM.L	D1..D4,A2..A4	TEST.W	D7		; retour EQ/NE	RET;--------\\; OBJDRAW >;========/; Dessine tous les objets d'une image.; in	A4.L	^image; out	-; mod	D7.WOBJDRAW:	PUSHM.L	D1..D4,A2..A4	CALL	OPEDISMAT	; dessine dans l'image	LOAD.L	A2,#(A6)+ODO	LOAD.W	D1,#NBSEARCH-1LOOP$:	TEST.B	(A2)+ODOAFF	; objet affich ?	JUMP',EQ NEXT$		; non => NEXT$	LOAD.L	A4,#R16"TAOBJ	LOAD.W	D4,(A2)+ODORAN	MUL.WU	D4,#6	ADD.L	A4,D4		; A4 <-- ^dans TAOBJ	LOAD.W	D4,(A4)+0	COMP.W	D4,(A6)+OIMA	JUMP',NE NEXT$	LOAD.W	D4,(A2)+ODOICO	; D4 <-- icne (0..5)	SL.W	D4,#1	INC.W	D4	LOAD.W	D3,#LYWDO-1	SUB.W	D3,(A4)+4	SWAP.W	D3	LOAD.W	D3,(A4)+2	LOAD.W	D2,#CLRDOT	CALL	OBJDRAWONE	; efface le pourtour	DEC.W	D4	LOAD.W	D2,#SETDOT	CALL	OBJDRAWONE	; dessine la chairNEXT$:	ADD.L	A2,#LDO	DECJ.W,NMO D1,LOOP$	CALL	CLODISMAT	; dessine dans l'cran	POPM.L	D1..D4,A2..A4	RET;-----------\\; OBJDRAWONE >;-----------/; Dessine un objet.; in	D2.W	mode de dessin;	D3.L	position dans l'image (y;x);	D4.W	numro de l'icne; out	-; mod	D7.WOBJDRAWONE:	PUSHM.L	D0..D6,A3,A4	LOAD.L	D0,D3	LOAD.W	D1,D4	CLR.W	D4		; D4 <-- numro de TOTO_P00.IMAGE	CALL	GMATIMAGE	; A4/D4 <-- ^image/dimensions	JUMP',NE EXIT$	LOAD.L	A3,A4		; A3 <-- ^image (source)	LOAD.W	D3,D1	MUL.WU	D3,#LXOBJ	INC.W	D3	SWAP.W	D3	LOAD.W	D3,#1	SWAP.W	D3	LOAD.W	D5,#LXWDO/8	LOAD.L	A4,#0		; A4 <-- cran (destination)	LOAD.L	D4,D0	LOAD.L	D1,#H'10000*(LYOBJ-1)+(LXOBJ-1)	TEST.B	(A0)+ODFCMD	; cran couleur ?	JUMP',EQ RASTER$	; non => RASTER$	OR.W	D2,#2^BSRCCOUL!2^BDSTCOULRASTER$:	CALL	DRRASTEREXIT$:	POPM.L	D0..D6,A3,A4	RET;--------\\; OBJLAST >;========/; Affiche le nombre d'objets restants.; in	-; out	-; mod	D7.WOBJLAST:	PUSHM.L	D1..D5	LOAD.W	D1,(A0)+ODFC1Y	ADD.W	D1,#4	SWAP.W	D1	LOAD.W	D1,(A0)+ODFC1X	ADD.W	D1,#4	COMP.W	(A0)+ODFDY,#LYWDO ; fentre plus haute que les images ?	JUMP',LS DRAW$		; non => DRAW$	CLR.L	D4	CALL	DRMDEF	ADD.W	D1,(A0)+ODFFX	ADD.W	D1,#50	CLR.L	D3	LOAD.W	D3,(A0)+ODFFX	LOAD.W	D4,(A0)+ODFC1Y	ADD.W	D4,(A0)+ODFC2Y	ADD.W	D4,#4+4	SWAP.W	D4	LOAD.W	D4,(A0)+ODFFDX	CLR.W	D5	LIB	?USEWDO		; utilise swdo principale	LOAD.W	D2,#LOADDOT	LIB	?DRTRAME	; efface un rectangleDRAW$:	COMP.W	(A6)+OIMA,#85	JUMP,EQ EXIT$	COMP.W	(A6)+OIMA,#86	JUMP,EQ EXIT$	COMP.W	(A6)+OIMA,#112	JUMP,EQ EXIT$	LOAD.L	D3,D1	LIB	?SETCURS	CLR.L	D4	LOAD.W	D4,(A6)+OREST	; D4 <-- nb de pices restantes	JUMP,EQ EXIT$	COMP.W	D4,#NBSEARCH	JUMP,EQ MAX$	COMP.W	D4,#1	JUMP,EQ LAST$	LIB	?AFTIM	.ASCIZE	"Il reste "	LOAD.W	D3,#3	LOAD.W	D2,#2^BAFDCM	LIB	?AFDEC	LIB	?AFTIM	.ASCIZE	" pices  trouver"	JUMP'	EXIT$LAST$:	LIB	?AFTIM	.ASCIZE	"Il reste une dernire pice  trouver !"	JUMP'	EXIT$MAX$:	LIB	?AFTIM	.ASCIZE	"Trouve les 100 pices ...";	JUMP'	EXIT$EXIT$:	LOAD.W	D5,(A6)+ONWDO	LIB	?USEWDO		; utilise la swdo pour les images	POPM.L	D1..D5	RET;--------\\; OBJINIT >;========/; Initialise tous les objets.; in	-; out	-; mod	D7.WOBJINIT:	PUSHM.L	D2..D4,A2..A4	LOAD.L	A4,#(A6)+OHAOBJ	CLR.W	D3	LOAD.W	D4,#NBOBJ	CALL	RZHAZARD	LOAD.L	A2,#(A6)+ODO	LOAD.W	D2,#NBSEARCH-1LOOP$:;	LOAD.L	A4,#(A6)+OHAOBJ	CLR.W	D3	LOAD.W	D4,#NBOBJ	CALL	EXHAZARD	; D4 <-- numro de l'objet	LOAD.W	(A2)+ODORAN,D4	CLR.W	D3	LOAD.W	D4,#MAXICONE	CALL	MMHAZARD	; D4 <-- numro de l'icne	LOAD.W	(A2)+ODOICO,D4	SET.B	(A2)+ODOAFF	ADD.L	A2,#LDO	DECJ.W,NMO D2,LOOP$	LOAD.W	(A6)+OREST,#NBSEARCH	POPM.L	D2..D4,A2..A4	RET	.END