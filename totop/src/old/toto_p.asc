	.TITLE	TOTO_P.ASC;	--------------------------------------;		(C) 1991 - Daniel Roux;	--------------------------------------;	Source du programme TOTO_P.CODETOTOREV	=	0		; versionTOTOVERS=	1		; rvision;	Date		Amliorations; --------------------------------------------------------------------------; 0.1	06.06.91	dbut des travaux	.PROC	M680002	.REF	SMAKY	.REF	MODULES	.REF	AUDIO	.REF	FONDU	.REF	TCOLOR	.REF	ICOLOR;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GRA_CRASTER = H'A899		; raster-op couleurGRA_GDOT = H'A89A		; get-dotBSRCCOUL = 11BDSTCOUL = 12SMAKY300 = 7;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	.REV	TOTOREV,TOTOVERS	.CODE	800,10,B'1111,600,2000,300,2000,2,'N,'E,'F,11	.TEXT	"(C)  Daniel ROUX et EPSITEC-system sa"; Constantes; ----------LXWDO	=	640		; largeur de l'cranLYWDO	=	340		; hauteur de l'cranLXOBJ	=	24		; largeur d'un objetLYOBJ	=	24		; hauteur d'un objetNBSEARCH=	100		; nb d'objets  chercherMARGOBJ	=	6		; marges autour des objetsMAXIMAGE=	200		; nb max d'imagesMAXOBJET=	300		; nb max d'objetsMAXICONE=	6		; nb max d'icnes dans TOTO_P000.IMAGEMAXSOUND=	100		; nb max de sonsRESMEM	=	100000		; rserve de mmoireLBUDIS	=	200		; lg max OBUDISLBUFILE	=	50		; lg max nom de fichierKEYDBOX	=	H'7E00		; "touche" trs spciale !PROGQUICK=	0		; progression immdiate; Fanions; -------BFSON	=	0		; bruitagesBFQUICK	=	1		; progressions rapides; Oprations; ----------OPDRAW	=	1		; py,px image,progressOPCLIC	=	2		; px,-py dx,dy adOPGOTO	=	3		; adOPDEL	=	4		; delOPINIT	=	5		; OPSOUND	=	6		; ad; Musiques AUDIO; --------------MA_BASE	=	H'10*0		; 0,1MA_BATEAU=	H'10*1		; 0MA_TELEPHONE=	H'10*2		; 0,1MA_POUPEE=	H'10*3		; 0MA_CLAIRON=	H'10*4		; 0MA_EAU	=	H'10*5		; 0MA_RONFLE=	H'10*6		; 0MA_HORLOGE=	H'10*7		; 0,1,2MA_GLOUGLOU=	H'10*8		; 0MA_GAGNE=	H'10*9		; 0MA_BOUM	=	H'10*10		; 0MA_VOITURE=	H'10*11		; 0MA_ESPACE=	H'10*12		; 0,1,2,3MA_CHATEAU=	H'10*13		; 0MA_ROI	=	H'10*14		; 0MA_CANARD=	H'10*15		; 0MA_OISEAU=	H'10*16		; 0MA_SIGNAUX=	H'10*17		; 0,1,2MA_COUCOU=	H'10*18		; 0; En-tte d'un fichier .IMAGE/.COLOR; ----------------------------------	.LOC	0	.BLKB	1		; OIMTYP: H'82	.BLKB	1		; OIMCOD: 0 ou 4	.BLKB	1		; OIMBIP: 4 bits/pixel	.BLKB	1		; OIMDIR: 2	.BLKB	2		; OIMDLX: largeur (multiple de 16)	.BLKB	2		; OIMDLY: hauteur	.BLKB	4		; OIMNBB: longueur du dataOIMSIZ:	.BLKB	2		; taille d'un pixel (4)OIMCNT:	.BLKB	2		; nb de pixels (1)OIMLGC:	.BLKB	4		; longueur de la CLUT	.BLKB	12		; rserve				; LGHIMA: longueur de l'en-tte; En-tte fichier .TOTOP; ----------------------HDID	=	H'D0D0FADA	; rigolo, non ?	.LOC	0OHDID:	.BLKB	4		; identificateurOHDREV:	.BLKB	1		; rvisionOHDVERS:.BLKB	1		; versionOHDNBO:	.BLKB	2		; nb d'objetsOHDLGO:	.BLKB	2		; lg d'un objetOHDFAN:	.BLKB	4		; fanionsOHDREST:.BLKB	2		; nb de pices restantesOHDIMA:	.BLKB	2		; numro de l'imageOHDPTR:	.BLKB	4		; ^relatif dans TABLELHEAD	=	256; Descripteur d'un objet dans une image; -------------------------------------	.LOC	0ODORAN:	.BLKB	2		; rang dans TAOBJODOICO:	.BLKB	2		; icne (0..5)ODOAFF:	.BLKB	1		; 1 => affich	.BLKB	5		; rserveLDO:; Descripteur d'une image en mmoire; ----------------------------------	.LOC	0ODIPC:	.BLKB	4		; ^image codeODIPD:	.BLKB	4		; ^image dcodeODIDIM:	.BLKB	4		; dimensionsLDI:; Descripteur d'un son en mmoire; -------------------------------	.LOC	0ODSPT:	.BLKB	4		; ^sonODSLG:	.BLKB	4		; longueurLDS:; Variables; ---------	.LOC	0OCHDBOX:.BLKB	2		; canal module DBOXOCHLIST:.BLKB	2		; canal module LISTOCHFOND:.BLKB	2		; canal module FONDUOCHICOL:.BLKB	2		; canal module ICOLOROCAFOND:.BLKB	4		; canal variables FONDUOMACHINE:.BLKB	1		; type de la machine (SMAKYxxx)OABORT:	.BLKB	1		; 1 => abort des processus filsOINV:	.BLKB	1		; 1 => fond de l'cran blancOCCMO:	.BLKB	1		; 1 => souris enleve	.EVENOSOUND:	.BLKB	2		; son  entendreOPDDIS:	.BLKB	4		; ^descripteur de la fentreOSDDIS:	.BLKB	LGDIS7		; copie du descripteur de la fentreOADRASTER:	.BLKB	4	;  adresse de GRA_RASTEROADCRASTER:	.BLKB	4	;  adresse de GRA_CRASTEROADMATRIX:	.BLKB	4	;  adresse de GRA_MATRIXOADDOT:		.BLKB	4	;  adresse de GRA_DOTOADTRAME:	.BLKB	4	;  adresse de GRA_TRAMEOADLINE:	.BLKB	4	;  adresse de GRA_LINEOADELLIPSE:	.BLKB	4	;  adresse de GRA_ELLIPSEOADFILLO:	.BLKB	4	;  adresse de GRA_FILLOOADFILLC:	.BLKB	4	;  adresse de GRA_FILLCOADCLEAR:	.BLKB	4	;  adresse de GRA_CLEAROADSET:		.BLKB	4	;  adresse de GRA_SETOADINV:		.BLKB	4	;  adresse de GRA_INVOBUDIS:	.BLKB	LBUDIS		; buffer write-displayONWDO:	.BLKB	2		; no swdo pour imagesOFAN:	.BLKB	4		; fanionsOIMA:	.BLKB	2		; numro de l'image visibleOREST:	.BLKB	2		; nb d'objets restantsOMUS:	.BLKB	2		; numro de la musique pour TMUSENFANTOLPT:	.BLKB	4		; ^dernier valideOLIMA:	.BLKB	2		; numro dernire image valideODI:	.BLKB	LDI*MAXIMAGE	; images chargesODO:	.BLKB	LDO*NBSEARCH	; objets  chercherODS:	.BLKB	LDS*MAXSOUND	; sons chargsOHAOBJ:	.BLKB	(MAXOBJET/8)+1	; hazard: objetsOHAZA:	.BLKB	8		; registre 63 bits pour gnrateur alatoireOBUHEAD:.BLKB	LHEAD		; en-tteOBUFILE:.BLKB	LBUFILE		; nom de fichierOBUSND:	.BLKB	200000		; buffer audioLGVAR:; Programme principal; -------------------	.LOC	0ADCODE:	JUMP	START; Erreurs fatales; ---------------TXERFATREV:	.ASCIZ	"Rvision du systme incompatible"TXERFATGRA:	.ASCIZ	"Erreur avec GRA"; Noms divers; -----------NMDBOX:	.ASCIZ	"DBOX"NMLIST:	.ASCIZ	"LIST"NMFOND:	.ASCIZ	"FONDU"NMICOL:	.ASCIZ	"ICOLOR"	.EVENSTART:	LIB	?OPELIB	LIB	?AFTIM	.B	NOCURS		; pas de curseur !	.B	NOEFLI		; pas de EFLI automatique	.B	TRUNC		; tronque les lignes trop longues	.B	MMODULO,1	; plus de modulos	.B	0	.EVEN	LOAD.L	D4,#LGVAR	LOAD.W	D1,#MTYPCP	GESMEM	?GETMEM		; demande mmoire pour variables	JUMP,NE ERFAT1	GESMEM	?CLEARMEM	; met toutes les variables  zro	LOAD.L	A6,A4		; A6 <-- ^variables	LOAD.L	A3,#R16"TXERFATREV	LOAD.W	D4,#H'AAAA	LIB	?GETREV		; D4 <-- rvision du systme	COMP.W	D4,#H'AAAA	; vielle librairie ?	JUMP,EQ ERFAT2		; oui => ERFAT2	COMP.W	D4,#H'100*5+4	; est-ce au moins 5.4 ?	JUMP,LO ERFAT2		; non => ERFAT2	LIB	?GETPDIS	LOAD.L	(A6)+OPDDIS,A4	LOAD.L	A0,A4		; A0 <-- ^descripteur de la fentre <<PREMANANT>>	SET.B	(A6)+OINV	; le fond de l'cran est blanc	TEST.B	(A0)+ODFCMD	JUMP,NE 15$	TEST.B	(A0)+ODFMOD:#BFBLANC	JUMP,BS 15$	CLR.B	(A6)+OINV15$:	NTREL	?GETMACHINE	; D4/A3 <-- paramtres	RL.L	D4,#8		; D4 <-- type de la machine	LOAD.B	(A6)+OMACHINE,D4	LOAD.L	(A6)+OFAN,#2^BFSON	LOAD.W	D4,#LYWDO	LOAD.W	D3,(A0)+ODFDY	SUB.W	D3,D4	SR.W	D3,#1	SWAP.W	D3	SWAP.W	D4	LOAD.W	D4,#LXWDO	LOAD.W	D3,(A0)+ODFDX	SUB.W	D3,D4	SR.W	D3,#1	AND.B	D3,#B'11110000	; D3 <-- utile pour SMAKY8 !;;?	LOAD.L	(A6)+OOIMA,D3	LIB	?CREWDO		; cre swdo (utile si grand cran)	LOAD.W	(A6)+ONWDO,D5	LIB	?USEWDO	LOAD.W	D3,#3	LIB	?MOUSE		; souris par le clavier	CALL	CCMO		; enlve la souris	LOAD.L	A3,#R16"NMDBOX	LOAD.W	D3,#DBOX_FIRST	LIB_	OPEN	JUMP,NE ERFAT2	LOAD.W	(A6)+OCHDBOX,D1	LOAD.L	A3,#R16"NMLIST	LOAD.W	D3,#LIST_FIRST	LIB_	OPEN	JUMP,NE ERFAT2	LOAD.W	(A6)+OCHLIST,D1	LOAD.L	A3,#R16"NMFOND	LOAD.W	D3,#FONDU_FIRST	LIB_	OPEN	JUMP,NE ERFAT2	LOAD.W	(A6)+OCHFOND,D1	PUSH.L	A0	FONDU_	OPEN	LOAD.L	A1,A0	POP.L	A0	TEST.W	D7	JUMP,NE ERFAT2	LOAD.L	(A6)+OCAFOND,A1	TEST.B	(A0)+ODFCMD	; cran couleur ?	JUMP',EQ NOICOL$	LOAD.L	A3,#R16"NMICOL	LOAD.W	D3,#ICOL_FIRST	LIB_	OPEN	JUMP,NE ERFAT2	LOAD.W	(A6)+OCHICOL,D1NOICOL$:	LOAD.L	A1,#R16"TXERFATGRA	LOAD.W	D3,#GRA_RASTER	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADRASTER,A3	LOAD.W	D3,#GRA_CRASTER	LIB_	GETAD	LOAD.L	(A6)+OADCRASTER,A3	LOAD.W	D3,#GRA_MATRIX	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADMATRIX,A3	LOAD.W	D3,#GRA_DOT	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADDOT,A3	LOAD.W	D3,#GRA_TRAME	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADTRAME,A3	LOAD.W	D3,#GRA_LINE	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADLINE,A3	LOAD.W	D3,#GRA_ELLIPSE	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADELLIPSE,A3	LOAD.W	D3,#GRA_FILLO	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADFILLO,A3	LOAD.W	D3,#GRA_FILLC	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADFILLC,A3	LOAD.W	D3,#GRA_CLEAR	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADCLEAR,A3	LOAD.W	D3,#GRA_SET	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADSET,A3	LOAD.W	D3,#GRA_INV	LIB_	GETAD	JUMP,NE ERFAT3	LOAD.L	(A6)+OADINV,A3	NTREL	?GETPRIO	; D4 <-- priorit de START	DEC.B	D4		; D4 <-- fils plus prioritaire !	AND.W	D4,#H'FF	LOAD.L	A5,#R16"PFILS1	LOAD.L	A3,#R16"NFILS1	LOAD.L	D5,#500		; D5 <-- lg stack	NTREL	?CRETASK	; cre le processus fils	JUMP,NE ERFAT2NEW$:	CALL	COUPSAC		; init hazard	CALL	OBJINIT		; init tous les objets	CALL	AFMENU		; affiche les soft-keys	LOAD.L	A4,#R16"TABLELOOP$:	TEST.W	(A6)+OREST	; reste des pices  trouver ?	JUMP,EQ END$		; non => END$	LOAD.W	D4,(A4+)	COMP.W	D4,#OPDRAW	JUMP,EQ DRAW$	COMP.W	D4,#OPCLIC	JUMP,EQ CLIC$	COMP.W	D4,#OPGOTO	JUMP,EQ GOTO$	COMP.W	D4,#OPDEL	JUMP,EQ DEL$	COMP.W	D4,#OPINIT	JUMP,EQ INIT$	COMP.W	D4,#OPSOUND	JUMP,EQ SOUND$	JUMP	FINI$DRAW$:	LOAD.W	D4,(A4+)	; D4 <-- numro	LOAD.L	D3,(A4+)	; D3 <-- position	LOAD.W	D2,(A4+)	; D2 <-- progression	LOAD.L	D1,(A4+)	; D1 <-- incrment/dlai	CALL	AFIMAGE		; affiche l'image	JUMP,NE ERROR$	JUMP	LOOP$CLIC$:	SUB.L	A4,#2	LOAD.L	(A6)+OLPT,A4	LOAD.W	(A6)+OLIMA,(A6)+OIMA	LOAD.W	(A6)+OSOUND,#TMUSDONECLIC0$:	CALL	OBJLAST		; affiche le nb d'objets restants	CALL	CLRFIFO		; annule les touches pressesCLIC1$:	CALL	SCMO		; remet la souris	LIB	?GETCAR		; attend clavier/souris	COMP.W	D3,#KEYMGR	JUMP,EQ CLIC1$	COMP.W	D3,#KEYMMR	JUMP,EQ CLIC1$	COMP.W	D3,#KEYMDR	JUMP,EQ CLIC1$	CALL	CCMO		; enlve la souris	COMP.W	D3,#KEYMGP	JUMP,EQ CLIC2$	COMP.W	D3,#KEYMMP	JUMP,EQ CLIC2$	COMP.W	D3,#KEYMDP	JUMP,EQ CLIC2$	COMP.W	D3,#F0+SHIFT	JUMP,EQ FINI$; ATTENTION: comparaison avec D3.L pour tenir compte du pseudo-code,; et interdire ainsi les clic avec la souris dans les soft-keys !	COMP.L	D3,#H'10000*1+F1+SHIFT	JUMP,EQ PREND$	COMP.L	D3,#H'10000*3+F3+SHIFT	JUMP,EQ SAUVE$	COMP.L	D3,#H'10000*4+F4+SHIFT	JUMP,EQ DEF$	COMP.L	D3,#H'10000*14+F14+SHIFT	JUMP,EQ EFFACE$	JUMP	CLIC8$CLIC2$:	CALL	IFMOUSE		; D4 <-- position de la souris	JUMP,NE CLIC8$	CALL	OBJDET		; enlve un objet ?	JUMP,EQ CLIC7$		; oui => CLIC7$	LOAD.L	A3,#(A4)-10+2CLIC4$:	ADD.L	A3,#10		; A3 <-- ^suivant	COMP.W	(A3),#-1	; fin de la table ?	JUMP,EQ CLIC8$		; oui => CLIC8$	LOAD.W	D2,D4	LOAD.W	D3,(A3)+0	COMP.W	D2,D3	JUMP,LT CLIC4$	ADD.W	D3,(A3)+4	COMP.W	D2,D3	JUMP,GE CLIC4$	LOAD.L	D2,D4	SWAP.W	D2	LOAD.W	D3,#LYWDO-1	SUB.W	D3,(A3)+2	COMP.W	D2,D3	JUMP,LT CLIC4$	ADD.W	D3,(A3)+6	COMP.W	D2,D3	JUMP,GE CLIC4$	LOAD.L	A4,#(A3)+8	JUMP'	GOTO$CLIC7$:	TEST.W	(A6)+OREST	; reste des pices  trouver ?	JUMP,EQ END$		; non => END$	JUMP	CLIC0$PREND$:	CALL	DBOXPREND	; reprend une partie ...	JUMP,NE CLIC0$	LOAD.W	D4,(A6)+OIMA	; D4 <-- numro	CLR.L	D3		; D3 <-- position	LOAD.W	D2,#PROGQUICK	; D2 <-- progression	CLR.L	D1		; D1 <-- incrment/dlai	CALL	AFIMAGE		; affiche l'image	JUMP,NE ERROR$	JUMP	LOOP$SAUVE$:	CALL	DBOXSAUVE	; sauve la partie ...	JUMP	CLIC0$DEF$:	CALL	DBOXDEF		; choix ...	JUMP	CLIC0$EFFACE$:	CALL	DBOXNEW		; recommence ...	JUMP,NE CLIC0$	COMP.W	D3,#CR	JUMP,EQ NEW$	JUMP	CLIC0$CLIC8$:	LOAD.W	(A6)+OSOUND,#TMUSLIT	JUMP	CLIC0$GOTO$:	CLR.L	D4	LOAD.W	D4,(A4)	LOAD.L	A4,#R16"ADCODE	ADD.L	A4,D4	JUMP	LOOP$DEL$:	LOAD.W	D4,(A4+)	NTREL	?DELMS	JUMP	LOOP$INIT$:	CALL	OBJINIT		; init tous les objets	JUMP	LOOP$SOUND$:	LOAD.W	(A6)+OSOUND,(A4+)	JUMP	LOOP$ERROR$:	CALL	DBOXERROR	; affiche l'erreur ...	LOAD.W	D4,(A6)+OLIMA	; D4 <-- numro	CLR.L	D3		; D3 <-- position	LOAD.W	D2,#PROGQUICK	; D2 <-- progression	CLR.L	D1		; D1 <-- incrment/dlai	CALL	AFIMAGE		; affiche l'image	LOAD.L	A4,(A6)+OLPT	; A4 <-- ^dernier valide	JUMP	LOOP$BIP$:	LOAD.W	(A6)+OSOUND,#TMUSLIT	JUMP	LOOP$END$:	LOAD.W	(A6)+OREST,#NBSEARCH	LOAD.L	A4,#R16"TFINI	JUMP	LOOP$FINI$:	CALL	DBOXQUITTE	; quitte TOTO ?	COMP.W	D3,#F1	JUMP,NE LOOP$;	JUMP	ERFATERFAT:	SET.B	(A6)+OABORT	; signal la fin au processus fils	NTREL	?WFABDESC	; attend leurs fins ...	PUSH.L	A0	LOAD.L	A0,(A6)+OCAFOND	FONDU_	CLOSE	POP.L	A0	LOAD.W	D1,(A6)+OCHDBOX	LIB_	CLOSE	LOAD.W	D1,(A6)+OCHLIST	LIB_	CLOSE	LOAD.W	D1,(A6)+OCHFOND	LIB_	CLOSE	TEST.B	(A0)+ODFCMD	; cran couleur ?	JUMP',EQ NOICOL$	LOAD.W	D1,(A6)+OCHICOL	LIB_	CLOSENOICOL$:	LOAD.L	A4,A6	LOAD.W	D1,#MTYPCP	GESMEM	?GIVMEM		; libre la mmoire des variablesERFAT1:	LIB	?CLOLIB	FOS	?STOPERFAT3:	LOAD.L	A3,A1		; A3 <-- ^messageERFAT2:	PUSH.W	D7	LIB	?AFTIM	.B	NOCURS,CR,CR	.ASCIZ	"ERREUR FATALE: "	.EVEN	LIB	?AFTEXT		; affiche le message	LIB	?AFCR	POP.W	D7	JUMP',EQ 50$	LIB	?AFERROR	; affiche l'erreur	LIB	?AFCR50$:	LIB	?GETCAR		; attend une touche ...	JUMP	ERFAT; Processus fils; --------------NFILS1:	.ASCIZ	"TOTO_SOUND"	.EVENPFILS1:LOOP$:	TEST.B	(A6)+OABORT	; fin ?	JUMP,T	END$		; oui => END$				; non =>	LOAD.W	D3,(A6)+OSOUND	JUMP,EQ DEL$	CLR.W	(A6)+OSOUND	COMP.W	D3,#TMUSENFANT	JUMP',NE PLAY$	LOAD.W	D4,(A6)+OMUS	INC.W	D4	COMP.W	D4,#11	JUMP',LO MUS$	CLR.W	D4MUS$:	LOAD.W	(A6)+OMUS,D4	LOAD.L	A4,#R16"TABLE$	SL.W	D4,#1	LOAD.W	D3,(A4)+(D4.W)	; D3 <-- musique pour TMUSENFANTPLAY$:	CALL	PATATRA		; fait le bruit	JUMP	LOOP$DEL$:	LOAD.W	D4,#50/10	NTREL	?DELMS		; attend un peu	JUMP	LOOP$END$:	NTREL	?ABORTTABLE$:	.W	TMUSNAVIRE	.W	TMUSLUNE	.W	TMUSDODO	.W	TMUSHAPPY	.W	TMUSMICHEL	.W	TMUSLORAINE	.W	TMUSBERGERE	.W	TMUSALOUETTE	.W	TMUSAVIGNON	.W	TMUSFONTAINE	.W	TMUSJACQUES; Gestion des bruits; ------------------;--------\\; PATATRA >;========/; Fait un bruit rigolo !; in	D3.W	#TMUSxxx; out	-; mod	D7.WPATATRA:	PUSHM.L	D3,D4,A4	TEST.B	(A6)+OFAN+3:#BFSON-0	JUMP,BC EXIT$	COMP.B	(A6)+OMACHINE,#SMAKY300	JUMP',EQ AUDIO$SIMPLE$:	COMP.W	D3,#2000	; musique audio ?	JUMP,LO EXIT$		; oui => EXIT$	LOAD.L	A4,#R16"ADCODE	AND.L	D3,#H'FFFF	; ADD.W A4,D3 impossible si D3.W ngatif !	ADD.L	D3,A4	LOAD.L	A4,D3	TEST.W	(A4)	JUMP,EQ EXIT$	LIB	?PLAY		; joue avec le pilote $SYNT	JUMP	EXIT$AUDIO$:	COMP.W	D3,#2000	; musique audio ?	JUMP',LO APLAY$		; oui => APLAY$	LOAD.L	A4,#R16"TABLE$-4ASRC$:	ADD.L	A4,#4		; A4 <-- ^suivant	TEST.W	(A4)		; fin de la table ?	JUMP',EQ AMUS$		; oui => AMUS$	COMP.W	D3,(A4)	JUMP,NE ASRC$	LOAD.W	D3,(A4)+2	; D3 <-- musique audioAPLAY$:	LOAD.W	D4,D3	CALL	SNDPLAY		; fait entendre un son audio	JUMP'	EXIT$AMUS$:	LOAD.L	A4,#R16"ADCODE	AND.L	D3,#H'FFFF	; ADD.W A4,D3 impossible si D3.W ngatif !	ADD.L	D3,A4	LOAD.L	A4,D3	TEST.W	(A4)	JUMP',EQ EXIT$	CALL	SNDMUSIQUEEXIT$:	POPM.L	D3,D4,A4	RETTABLE$:	.W	TMUSDONE,MA_BASE+1	.W	TMUSOBJET,MA_BASE+0	.W	TMUSBAD,MA_BOUM+0	.W	TMUSMAGIC,MA_ESPACE+3	.W	TMUSTAC,MA_HORLOGE+1	.W	TMUSTIC,MA_HORLOGE+2	.W	0	.INS	TOTO_POBJ.ASI	.INS	TOTO_PIMAGE.ASI	.INS	TOTO_PSOUND.ASI	.INS	TOTO_PDBOX.ASI	.INS	TOTO_PMISC.ASI	.INS	TOTO_PTABLE.ASI	.INS	TOTO_PMUS.ASI	.END	START