	.SBTTL	TOTO_PSOUND.ASI;--------\\; SNDPLAY >;========/; Fait entendre un son AUDIO.; in	D4.W	numro du son (0..n);		  0..3: rang dans le fichier;		 4..15: numro du fichier; out	D7.W	erreur; mod	D7.WSNDPLAY:	PUSHM.L	D5,D6	TEST.B	(A6)+OAUDIO	JUMP',F	ERROR$	CALL	SNDCACHE	; D5 <-- canal du son	JUMP',NE EXIT$	AND.W	D4,#H'000F	LOAD.L	D6,(A6)+OCAAUDI	AUDIO_	MUSIC		; fait entendre le son	CLR.W	D7		; D7 <-- ok	JUMP'	EXIT$ERROR$:	LOAD.W	D7,#1EXIT$:	POPM.L	D5,D6	TEST.W	D7		; retour EQ/NE	RET;---------\\; SNDCACHE >;=========/; Cache un son, si ncessaire.; in	D4.W	numro du son (0..n); out	D5.L	canal du son;	D7.W	erreur; mod	D5.L, D7.WSNDCACHE:	PUSHM.L	D4,A2,A3	CALL	SNDGETD		; A2 <-- ^ODS*	TEST.L	(A2)+ODSCH	; son dj charg ?	JUMP',NE OK$		; oui => OK$	CALL	SNDNAME		; A3 <-- ^nom	CALL	SNDREAD		; lit un son	JUMP',NE EXIT$	LOAD.L	(A2)+ODSCH,D5	LOAD.W	(A2)+ODSNB,D4OK$:	LOAD.L	D5,(A2)+ODSCH	; D5 <-- canal du son	CLR.W	D7		; D7 <-- okEXIT$:	POPM.L	D4,A2,A3	TEST.W	D7		; retour EQ/NE	RET;-----------\\; SNDUNCACHE >;===========/; Dcache un son, si ncessaire.; in	D4.W	numro du son (0..n); out	-; mod	D7.WSNDUNCACHE:	PUSHM.L	D5,D6,A2	CALL	SNDGETD		; A2 <-- ^ODS*	LOAD.L	D5,(A2)+ODSCH	JUMP',EQ EXIT$	LOAD.L	D6,(A6)+OCAAUDI	AUDIO_	UNCACHE		; libre le son	CLR.L	(A2)+ODSCHEXIT$:	POPM.L	D5,D6,A2	RET;--------\\; SDNGETD >;--------/; Cherche le descripteur d'un son.; in	D4.W	numro du son (0..n); out	A2.L	^ODS*; mod	D7.W, A2.LSNDGETD:	PUSH.L	D4	LOAD.L	A2,#(A6)+ODS	SR.W	D4,#4	MUL.WU	D4,#LDS	ADD.L	A2,D4		; A2 <-- ^ODS*	POP.L	D4	RET;--------\\; SNDNAME >;--------/; Gnre le nom d'un son.; in	D4.W	numro du son (0..999); out	A3.L	^nom; mod	D7.W, A3.LSNDNAME:	PUSHM.L	D2..D4,A4	LOAD.L	A4,#(A6)+OBUFSN	LOAD.L	A3,#R16"PREF$XFER1$:	LOAD.B	(A4+),(A3+)	; OBUFSN <-- prfixe	JUMP,NE XFER1$	DEC.L	A4	LOAD.W	D2,#2^BAFDALL	LOAD.W	D3,#3	SR.W	D4,#4	AND.L	D4,#H'FFFF	LIB	?PUTDEC		; OBUFSN <-- numro	LOAD.L	A3,#R16"POST$XFER2$:	LOAD.B	(A4+),(A3+)	; OBUFSN <-- extension	JUMP,NE XFER2$;	DEC.L	A4	LOAD.L	A3,#(A6)+OBUFSN	; A3 <-- ^nom	POPM.L	D2..D4,A4	RETPREF$:	.ASCIZ	"(:,#:)TOTO_P"POST$:	.ASCIZ	".AUDIO"	.EVEN;--------\\; SNDREAD >;========/; Lit un fichier TOTO_Pnnn.AUDIO; in	A3.L	^nom; out	D5.L	canal du son;	D4.W	nb de sons;	D7.W	erreur; mod	D4.L, D5.L, D7.WSNDREAD:	PUSH.L	D6	LOAD.L	D6,(A6)+OCAAUDI	AUDIO_	CACHE		; D5/D4 <-- canal/nb	JUMP',EQ EXIT$	LOAD.W	D4,D7	AND.W	D4,#H'FF00	COMP.W	D4,#ERGESM	; erreur avec GESMEM ?	JUMP',NE EXIT$		; non => EXIT$	CALL	FREEMEM		; libre le maximum;	LOAD.L	D6,(A6)+OCAAUDI	AUDIO_	CACHE		; D5/D4 <-- canal/nbEXIT$:	POP.L	D6	TEST.W	D7		; retour EQ/NE	RET;-----------\\; SNDMUSIQUE >;===========/; Joue une musique.; in	A4.L	^table; out	-; mod	D7.WSNDMUSIQUE:	PUSH.L	D6	LOAD.L	D6,(A6)+OCAAUDI	AUDIO_	PLAY	POP.L	D6	RET	.END